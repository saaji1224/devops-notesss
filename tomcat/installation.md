## creation of vm 
```bash
gcloud compute instances create tomcat --zone=us-west4-b
--machine-type=e2-medium --create-disk=auto-delete=yes,boot=yes,device-name=tomcat,image=projects/centos-cloud/global/images/centos-7-v20240515,mode=rw,size=20
```

## Installting java 1.8 on CentOs 
```bash
 cd /opt

 yum install wget -y

 wget -c --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.rpm

 yum install jdk-8u131-linux-x64.rpm -y

 java -version
```
## Tomact 9 installation 
link [download](https://tomcat.apache.org/download-90.cgi)
```bash
wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.89/bin/apache-tomcat-9.0.89.zip

yum install unzip -y

unzip apache-tomcat-9.0.89.zip

mv apache-tomcat-9.0.89 tomcat9

 * need to check tomcat is runnig are not [ip_address:8080]
ps -ef | grep -i java*  ## this command will helping us to get the process that is been runnig inside the linux server

#start the tomcat process
cd /opt/tomcat9/bin
sh startup.sh   ##This will not run as the files i  bin folder are not having executable permission 
chmod +x *   #it will give execute permission to all files
sh startup.sh 

# we should run the above command by switching to a particular directory 
# We cant run the command from any where else.

# to start and stop the tomcat from anywhere in the vm, we can create link

ln -s /opt/tomcat9/bin/startup.sh /usr/bin/startTomcat
ln -s /opt/tomcat9/bin/shutdown.sh /usr/bin/stopTomcat
```
## Access Tomcat server from web
  * Once the tomcat is successfuly started, we can acces tomcat server at public_ip:8080 
  * Once the homepage click on `manger app` and `hostmanger` the page will populate with `403`
  * We need to perform the following steps to come out of this issue 
## Manger app
```bash
# It gives 403 Access Denied 
cd /opt/tomcat9/webapps/manager/META-INF
vi context.xml
<!--
<Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />
-->

```
  * manager-gui --> manager/service status/application deployment 
  * admin-gui  ---> host manager
* After we save the file now try to access the manager page from the web. You should be able to get login   page

* Try to access hostmanger from the we, still u will be getting `403`,
because we have made a mofification in the `context.xml` file under `manager` only 
* If you want to reflect the same to `hostmanager` perform the above setup here as well.

## Credentials for login to manger 
* We need to perform the following steps to create a `user` and access tomcat from the user.

```bash

cd /opt/tomcat9/conf

vi tomcat-users.xml  # add this lines in above file 
 <user username="saacademy" password="password" roles="manager-gui,admin-gui,manager,admin-script,manager-script,manager-status,manager-jmx" />
```
* After this modification try to login to `manager` with the above credentials
    * application ---> war -----> deploy to `tomcat`

* if we want to change the port number 
```bash (optional)
cd /opt/tomcat9/conf
vi server.xml 
Connector port="8082" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               maxParameterCount="1000"
               />
cd /opt/tomcat9/bin
sh shutdown.sh
sh startup.sh
(or)
public_ip:8082

stopTomcat
startTomcat

```
## Deploy flow
 `SRC` ---> `mvn package`(jar/war) ---> `deploy`

 ## Tomcat directory startucre
  * `bin`
      * This directory will be having all binary file related to start and stop tomcat server.
      * It will be consisting of startup and shutdown scripts
          `startup.sh`
             * This file is used to start the tomcat server on linux/mac machines
          `startup.bat`
             *  This file is used to start the tomcat server windows machines
          `catalina.sh`
             * this file is used to stop and start the tomact server like `restart`
  * `conf`
      * This contains the configuration file for tomcat
      * In maven we are having some thing called as `setting.xml`
      * In tomcat we have most importent file called as `server.xml` and `tomcat-user.xml` 
  * `lib`
      * This will be consist of libraries
      * Any software that is been developed by java will be consisting of jar files.
      * This jar files are used to run tomcat server. 
  * `logs`
      * This logs are for tomcat server not your typical applocation
      * By default when we download/unarchive the tomcat server this log folder will be empty
      * Once we start the tomcat server it generate typically 4 files
         * manger.log
         * hostmanger.log
         * catalina.out
         * localhost.log
  * `webapps`
      * We will be generally deploying our application based artifact which is been generated by maven in this folder
      * By default there will be 5 apps in the  `webapps` directory
      * We can deploy our custom application here and it support n number of application 
  * `temp`
      * It consists of all the `temp` files
  * `work`
      * Once we deploy the application in the webapps folder those apps generating some files(eg:jar, pom.xml,property) these are store in work directory

      ## install web servers in Centos, redhat
      ```bash
      yum install httpd

      apt install apache2 #for ubuntu
      
      ```

      ## commands
    ```bash

    setsebool -P httpd_can_network_connect 1
    setsebool -P httpd_can_network_connect 1
    setsebool -P httpd_can_network_relay 1
    setsebool -P httpd_graceful_shutdown 1
    setsebool -P nis_enabled 1
    systemctl restart httpd
    ```
  