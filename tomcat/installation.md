## creation of vm 
```bash
gcloud compute instances create tomcat --zone=us-west4-b
--machine-type=e2-medium --create-disk=auto-delete=yes,boot=yes,device-name=tomcat,image=projects/centos-cloud/global/images/centos-7-v20240515,mode=rw,size=20
```

## Installting java 1.8 on CentOs 
```bash
 cd /opt

 yum install wget -y

 wget -c --header "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.rpm

 yum install jdk-8u131-linux-x64.rpm -y

 java -version
```
## Tomact 9 installation 
link [download](https://tomcat.apache.org/download-90.cgi)
```bash
wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.89/bin/apache-tomcat-9.0.89.zip

yum install unzip -y

unzip apache-tomcat-9.0.89.zip

mv apache-tomcat-9.0.89 tomcat9

 * need to check tomcat is runnig are not [ip_address:8080]
ps -ef | grep -i java*  ## this command will helping us to get the process that is been runnig inside the linux server

#start the tomcat process
cd /opt/tomcat9/bin
sh startup.sh   ##This will not run as the files i  bin folder are not having executable permission 
chmod +x *   #it will give execute permission to all files
sh startup.sh 

# we should run the above command by switching to a particular directory 
# We cant run the command from any where else.

# to start and stop the tomcat from anywhere in the vm, we can create link

ln -s /opt/tomcat9/bin/startup.sh /usr/bin/startTomcat
ln -s /opt/tomcat9/bin/shutdown.sh /usr/bin/stopTomcat
```
## Access Tomcat server from web
  * Once the tomcat is successfuly started, we can acces tomcat server at public_ip:8080 
  * Once the homepage click on `manger app` and `hostmanger` the page will populate with `403`
  * We need to perform the following steps to come out of this issue 
## Manger app
```bash
# It gives 403 Access Denied 
cd /opt/tomcat9/webapps/manager/META-INF
vi context.xml
<!--
<Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />
-->

```
  * manager-gui --> manager/service status/application deployment 
  * admin-gui  ---> host manager
* After we save the file now try to access the manager page from the web. You should be able to get login   page

* Try to access hostmanger from the we, still u will be getting `403`,
because we have made a mofification in the `context.xml` file under `manager` only 
* If you want to reflect the same to `hostmanager` perform the above setup here as well.

## Credentials for login to manger 
* We need to perform the following steps to create a `user` and access tomcat from the user.

```bash

cd /opt/tomcat9/conf

vi tomcat-users.xml  # add this lines in above file 
 <user username="saacademy" password="password" roles="manager-gui,admin-gui,manager,admin-script,manager-script,manager-status,manager-jmx" />
```
* After this modification try to login to `manager` with the above credentials
    * application ---> war -----> deploy to `tomcat`

* if we want to change the port number 
```bash (optional)
cd /opt/tomcat9/conf
vi server.xml 
Connector port="8082" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               maxParameterCount="1000"
               />
cd /opt/tomcat9/bin
sh shutdown.sh
sh startup.sh
(or)
public_ip:8082

stopTomcat
startTomcat

```
## Deploy flow
 `SRC` ---> `mvn package`(jar/war) ---> `deploy`

 ## Tomcat directory startucre
  * `bin`
      * This directory will be having all binary file related to start and stop tomcat server.
      * It will be consisting of startup and shutdown scripts
          `startup.sh`
             * This file is used to start the tomcat server on linux/mac machines
          `startup.bat`
             *  This file is used to start the tomcat server windows machines
          `catalina.sh`
             * this file is used to stop and start the tomact server like `restart`
  * `conf`
      * This contains the configuration file for tomcat
      * In maven we are having some thing called as `setting.xml`
      * In tomcat we have most importent file called as `server.xml` and `tomcat-user.xml` 
  * `lib`
      * This will be consist of libraries
      * Any software that is been developed by java will be consisting of jar files.
      * This jar files are used to run tomcat server. 
  * `logs`
      * This logs are for tomcat server not your typical applocation
      * By default when we download/unarchive the tomcat server this log folder will be empty
      * Once we start the tomcat server it generate typically 4 files
         * manger.log
         * hostmanger.log
         * catalina.out
         * localhost.log
  * `webapps`
      * We will be generally deploying our application based artifact which is been generated by maven in this folder
      * By default there will be 5 apps in the  `webapps` directory
      * We can deploy our custom application here and it support n number of application 
  * `temp`
      * It consists of all the `temp` files
  * `work`
      * Once we deploy the application in the webapps folder those apps generating some files(eg:jar, pom.xml,property) these are store in work directory

      ## install web servers in Centos, redhat
      ```bash
      yum install httpd

      apt install apache2 #for ubuntu
      
      ```

      ## commands
    ```bash

    setsebool -P httpd_can_network_connect 1
    setsebool -P httpd_can_network_connect 1
    setsebool -P httpd_can_network_relay 1
    setsebool -P httpd_graceful_shutdown 1
    setsebool -P nis_enabled 1
    systemctl restart httpd
    ```

    ### SonarQube
     * It is a code quality tool
     * It is a web based tool
     * It will support to both open source as well as paid 
     * It supports multiple `Data bases` 
         * `MySql`
         * `Oracle`
     * SonarQube will not validate the logic of test cases
     * It is self managed static code tool for continous code based inspection

     ## Sonar Qube installatio
     # create vm 
     ```bash
     gcloud compute instances create sonarqube  --zone=us-west4-b --machine-type=e2-medium  --create-disk=auto-delete=yes,boot=yes,device-name=sonarqube,image=projects/centos-cloud/global/images/centos-7-v20230615,mode=rw,size=20
     ```
 ## Install Openjdk 17, mvn 3.8.8 on Centos:
```bash
# https://techviewleo.com/install-java-openjdk-on-rocky-linux-centos/
# Install Openjdk 17
sudo yum -y install wget curl
cd /opt/
wget https://download.java.net/java/GA/jdk17.0.2/dfd4a8d0985749f896bed50d7138ee7f/8/GPL/openjdk-17.0.2_linux-x64_bin.tar.gz
tar xvf openjdk-17.0.2_linux-x64_bin.tar.gz
sudo mv jdk-17.0.2/ /opt/jdk-17/
vim ~/.bashrc
  export JAVA_HOME=/opt/jdk-17
  export PATH=$PATH:$JAVA_HOME/bin
source ~/.bashrc
echo $JAVA_HOME
java --version

# Install Maven 3.8.8
cd /opt/
# wget https://dlcdn.apache.org/maven/maven-3/3.8.7/binaries/apache-maven-3.8.7-bin.tar.gz
wget https://dlcdn.apache.org/maven/maven-3/3.8.8/binaries/apache-maven-3.8.8-bin.tar.gz
tar -xzvf apache-maven-3.8.8-bin.tar.gz
vi ~/.bashrc
  export PATH=$PATH:/opt/apache-maven-3.8.8/bin
  export M2_HOME=/opt/apache-maven-3.8.8
source ~/.bashrc
mvn --version

# For All Users
---------------------- 
vi /etc/profile
  export JAVA_HOME=/opt/jdk-17
  export PATH=$PATH:$JAVA_HOME/bin
  export PATH=$PATH:/opt/apache-maven-3.8.8/bin
  export M2_HOME=/opt/apache-maven-3.8.8

source /etc/profile
mvn --version     
```
### Sonarqube instaling
```bash 
wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.5.90363.zip
yum install unzip -y
mv sonarqube-9.9.5.90363 sonarqube-9.9
```
* by default Sonar will not be executed with `root` user
* We need to create a `user` called as sonar and start the applicaiton with that user

 ```bash
 useradd sonar

 #visudo
sonar           ALL=(ALL)       NOPASSWD: ALL
chown -R sonar:sonar /opt/sonarqube-9.9
#chmod -R 775 /opt/sonarqube-9.9
```
- Once this is done we need run/start the sonar
- sonarqube will be started by `sonar` user
- we need to switch to sonar user

```bash
# switch sonar user

su - sonar
cd /opt/sonarqube-9.7
cd bin
cd linux-x86-64/
sh sonar.sh start

# To Verify status of sonarqube
sh sonar.sh status
```
- Once the installation is successful, sonarqube can be acessible at port `9000`
- It will ask for userid/passwd.
    * By default sonarqube has created as userid as `admin` and password as `admin`
    * Popup appears to change the password. Do change it and makesure u remember the password, as its difficult to get it back.

## Create a sample maven project
```bash
# https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html
mvn archetype:generate -DgroupId=com.sivaacademy.app -DartifactId=my-maven-app -DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DinteractiveMode=false
# mvn compile > mvn package
vi pom.xml
<properties>
  <sonar.host.url>http://34.125.87.116:9000/</sonar.host.url>
  <sonar.login>admin</sonar.login>
  <sonar.password>sonar1234</sonar.password>
</properties>
mvn sonar:sonar
```

